
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/GameMenu.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5cb45NS+yZNLbHP815RF0Ab', 'GameMenu');
// Script/GameMenu.js

"use strict";

var Utils = require("Utils");

var ShareSdk = require("ShareSdk");

var RankList = require("RankList");

cc.Class({
  "extends": cc.Component,
  properties: {
    m_sp_logo: cc.Node,
    m_l_maingold: cc.Label,
    m_sp_off: cc.Node,
    m_spa_list: cc.SpriteAtlas,
    m_sp_mystepicon: cc.Sprite,
    m_l_mystepname: cc.Label,
    m_n_starlist: {
      type: cc.Node,
      "default": []
    },
    m_n_skinpanel: cc.Node,
    m_n_moregame: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    window.GAME_MENU = this;
    Utils.setDesignResolution();
  },
  start: function start() {
    var _this = this;

    // this.m_sp_logo.runAction(cc.repeatForever(cc.sequence(cc.moveBy(1, 0, 15), cc.moveBy(1, 0, -15))));
    EVENT_LISTENER.on(window.GAME_UPDATE_DATA, this.updateGold, this);
    this.m_l_maingold.string = window.INIT_GAME_SAVE_DATA.gold_num;
    this.showGameClubButton();
    this.updateMusicBtnSprite(window.MUSIC_SHOW_OFF);
    RankList.setScore(window.INIT_GAME_SAVE_DATA.top_score);

    if (typeof wx != "undefined") {
      wx.showShareMenu({
        withShareTicket: true
      });
      wx.onShareAppMessage(function () {
        return {
          title: "好玩又新奇，消磨时间好帮手",
          imageUrl: window.tempFileURL[1]
        };
      });
    }

    this.showAdBanner(true);

    if (!window.SHOWNEWYEAR && window.NEWYEAR) {
      Utils.loadRes("prefabs/happynewyear", cc.Prefab, function (obj) {
        var node = cc.instantiate(obj);
        node.zIndex = 1 << 10;
        node.parent = _this.node;
        window.SHOWNEWYEAR = true;
      });
    } else {
      Utils.playBgmMusic(window.BGM, 0.5);
    }

    this.initMyData();
    this.m_n_moregame.active = window.MOVEGAME;
  },
  playmuisc: function playmuisc() {
    Utils.playBgmMusic(window.BGM, 0.5);
  },
  initMyData: function initMyData() {
    var curlv = window.INIT_GAME_SAVE_DATA.top_level;
    var data = this.getMyStepData(curlv);

    if (data) {
      this.m_sp_mystepicon.spriteFrame = this.m_spa_list.getSpriteFrame(data.icon_path);
      this.m_l_mystepname.string = data.desc;

      for (var i = 0; i < this.m_n_starlist.length; i++) {
        this.m_n_starlist[i].active = i < data.star;
      }
    } else {
      this.m_sp_mystepicon.spriteFrame = this.m_spa_list.getSpriteFrame("stepicon6");
      this.m_l_mystepname.string = window.STEP_CONFIG[0].desc;

      for (var _i = 0; _i < this.m_n_starlist.length; _i++) {
        this.m_n_starlist[_i].active = _i < 3;
      }
    }

    this.m_n_skinpanel.getComponent("SkinPanel").initData();
  },
  getMyStepData: function getMyStepData(lv) {
    var index = Math.floor(lv / 10);

    if (index <= 0) {
      return null;
    } else {
      if (index > window.STEP_CONFIG.length) index = window.STEP_CONFIG.length;
      return window.STEP_CONFIG[index - 1];
    }
  },
  updateGold: function updateGold() {
    this.m_l_maingold.string = window.INIT_GAME_SAVE_DATA.gold_num;
  },
  onStartGame: function onStartGame() {
    Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);
    cc.director.loadScene(window.GAME_SCENE_NAME);
  },
  onCloseShare: function onCloseShare() {
    cc.director.loadScene(window.GAME_SCENE_NAME);
  },
  onShareStart: function onShareStart() {
    var self = this;
    Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);
    ShareSdk.shareAppMessage({
      title: "来助力我一起打怪兽吧",
      imageUrl: window.tempFileURL[1],
      success: function success(res) {
        cc.director.loadScene(window.GAME_SCENE_NAME);
      },
      fail: function fail(err) {},
      complate: function complate(msg) {}
    });
  },
  onOpenSkinPanel: function onOpenSkinPanel() {
    this.m_n_skinpanel.active = true;
  },
  onOpenStepRank: function onOpenStepRank() {
    Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);
    if (window.isWeChatPlatform) wx.showLoading({
      title: "加载中..."
    });
    cc.director.loadScene(window.STEP_SCENE_NAME, function () {
      if (window.isWeChatPlatform) wx.hideLoading();
    });
  },
  onMusicBtnClick: function onMusicBtnClick() {
    if (window.MUSIC_SHOW_OFF == 1) {
      window.MUSIC_SHOW_OFF = 0;
      Utils.stopBgmMusic();
      cc.sys.localStorage.setItem('music', '0');
    } else {
      window.MUSIC_SHOW_OFF = 1;
      Utils.playBgmMusic(window.BGM, 0.5);
      cc.sys.localStorage.setItem('music', '1');
    }

    this.updateMusicBtnSprite(window.MUSIC_SHOW_OFF);
  },
  updateMusicBtnSprite: function updateMusicBtnSprite(show_off) {
    if (show_off == 1) {
      this.m_sp_off.active = false;
    } else {
      this.m_sp_off.active = true;
    }
  },
  onShare: function onShare() {
    Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1); // console.log(cc.url.raw("resources/common/sharepic.85663.png"));

    ShareSdk.shareAppMessage({
      title: "今年最好玩最刺激的六边形消除怪兽游戏，快来尝试下",
      imageUrl: window.tempFileURL[1],
      success: function success(res) {
        console.log("res", res);
      },
      fail: function fail(err) {
        console.log("res-err");
      },
      complate: function complate(msg) {
        console.log("complate");
      }
    });
  },
  onMoreGame: function onMoreGame() {// if (typeof (wx) != 'undefined' && wx.navigateToMiniProgram) {
    //     wx.navigateToMiniProgram({
    //         appId: "wx7109309214f4c86e",
    //         //target: "wx6ee9cae077851dfa",
    //         success: res => {
    //             console.log('跳转成功');
    //             // successs && successs(res);
    //         },
    //         fail: err => {
    //             console.log("跳转失败：", err);
    //             // faill && faill(err);
    //         },
    //         complete: res => {
    //             console.log('跳转完成')
    //             // completee && completee(res);
    //         }
    //     });
    // } else {
    //     wxShortCut.showModal("提示", "暂未开放");
    // }
  },
  showGameClubButton: function showGameClubButton() {
    if (typeof wx != 'undefined') {
      if (!this.clubbutton) {
        this.clubbutton = wx.createGameClubButton({
          icon: 'light',
          style: {
            left: 10,
            top: 300,
            width: 40,
            height: 40
          }
        });
      }

      this.clubbutton.show();
    }
  },
  hideGameClubButton: function hideGameClubButton() {
    if (this.clubbutton) {
      this.clubbutton.hide();
    }
  },
  onDestroy: function onDestroy() {
    if (this.clubbutton) {
      this.clubbutton.destroy();
      this.clubbutton = null;
    }

    if (this.m_bannerad) {
      this.m_bannerad.destroy();
      this.m_bannerad = null;
    }

    EVENT_LISTENER.off(window.GAME_UPDATE_DATA, this);
    window.GAME_MENU = null;
  },
  showAdBanner: function showAdBanner(boo) {
    if (typeof wx == 'undefined') return;
    var Size = cc.winSize;
    var Widthnode = cc.find("Canvas/n_funnymap/n_bannerpos");
    var pos = this.node.convertToWorldSpace(Widthnode);

    if (Size.height / Size.width > 2) {
      //适配全面屏 适用于FIXHeight
      pos.y += (Size.height - 1920) / 2;
    }

    var system = wx.getSystemInfoSync();
    var adaptScaleH = system.screenHeight / Size.height;
    var PosY = (Size.height - pos.y) * adaptScaleH;
    var self = this;

    if (!boo) {
      if (this.m_bannerad) {
        this.m_bannerad.hide();
      }
    } else {
      if (this.m_bannerad) this.m_bannerad.show();
    }

    if (!this.m_bannerad && boo) {
      if (system.SDKVersion < '2.0.4') {
        wx.showToast({
          title: "微信版本过低，无法创建广告banner",
          icon: "none",
          image: "",
          duration: 0
        });
        setTimeout(function () {
          return wx.hideToast();
        }, 3000);
      } else {
        self.m_bannerad = wx.createBannerAd({
          adUnitId: 'adunit-9dd057b6b514245a',
          style: {
            left: 0,
            top: PosY,
            width: system.screenWidth
          }
        });
        self.m_bannerad.onResize(function (res1) {
          try {
            if (self.m_bannerad && self.m_bannerad.style) {
              self.m_bannerad.style.top = PosY;
              self.m_bannerad.style.height = res1.height;
            }
          } catch (error) {
            console.log("onResize-error", error);
          }
        });
        self.m_bannerad.onLoad(function () {
          console.log('banner 广告加载成功');
        });
        self.m_bannerad.show().then(function () {
          console.log("广告显示成功");
        })["catch"](function (err) {
          console.error("广告加载失败", err);
        });
        self.m_bannerad.onError(function (err) {
          console.error(err);
        });
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxHYW1lTWVudS5qcyJdLCJuYW1lcyI6WyJVdGlscyIsInJlcXVpcmUiLCJTaGFyZVNkayIsIlJhbmtMaXN0IiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJtX3NwX2xvZ28iLCJOb2RlIiwibV9sX21haW5nb2xkIiwiTGFiZWwiLCJtX3NwX29mZiIsIm1fc3BhX2xpc3QiLCJTcHJpdGVBdGxhcyIsIm1fc3BfbXlzdGVwaWNvbiIsIlNwcml0ZSIsIm1fbF9teXN0ZXBuYW1lIiwibV9uX3N0YXJsaXN0IiwidHlwZSIsIm1fbl9za2lucGFuZWwiLCJtX25fbW9yZWdhbWUiLCJvbkxvYWQiLCJ3aW5kb3ciLCJHQU1FX01FTlUiLCJzZXREZXNpZ25SZXNvbHV0aW9uIiwic3RhcnQiLCJFVkVOVF9MSVNURU5FUiIsIm9uIiwiR0FNRV9VUERBVEVfREFUQSIsInVwZGF0ZUdvbGQiLCJzdHJpbmciLCJJTklUX0dBTUVfU0FWRV9EQVRBIiwiZ29sZF9udW0iLCJzaG93R2FtZUNsdWJCdXR0b24iLCJ1cGRhdGVNdXNpY0J0blNwcml0ZSIsIk1VU0lDX1NIT1dfT0ZGIiwic2V0U2NvcmUiLCJ0b3Bfc2NvcmUiLCJ3eCIsInNob3dTaGFyZU1lbnUiLCJ3aXRoU2hhcmVUaWNrZXQiLCJvblNoYXJlQXBwTWVzc2FnZSIsInRpdGxlIiwiaW1hZ2VVcmwiLCJ0ZW1wRmlsZVVSTCIsInNob3dBZEJhbm5lciIsIlNIT1dORVdZRUFSIiwiTkVXWUVBUiIsImxvYWRSZXMiLCJQcmVmYWIiLCJvYmoiLCJub2RlIiwiaW5zdGFudGlhdGUiLCJ6SW5kZXgiLCJwYXJlbnQiLCJwbGF5QmdtTXVzaWMiLCJCR00iLCJpbml0TXlEYXRhIiwiYWN0aXZlIiwiTU9WRUdBTUUiLCJwbGF5bXVpc2MiLCJjdXJsdiIsInRvcF9sZXZlbCIsImRhdGEiLCJnZXRNeVN0ZXBEYXRhIiwic3ByaXRlRnJhbWUiLCJnZXRTcHJpdGVGcmFtZSIsImljb25fcGF0aCIsImRlc2MiLCJpIiwibGVuZ3RoIiwic3RhciIsIlNURVBfQ09ORklHIiwiZ2V0Q29tcG9uZW50IiwiaW5pdERhdGEiLCJsdiIsImluZGV4IiwiTWF0aCIsImZsb29yIiwib25TdGFydEdhbWUiLCJTZXRTb3VuZEVmZmVjdCIsIkJVVFRPTl9DTElDS19NVVNJQyIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwiR0FNRV9TQ0VORV9OQU1FIiwib25DbG9zZVNoYXJlIiwib25TaGFyZVN0YXJ0Iiwic2VsZiIsInNoYXJlQXBwTWVzc2FnZSIsInN1Y2Nlc3MiLCJyZXMiLCJmYWlsIiwiZXJyIiwiY29tcGxhdGUiLCJtc2ciLCJvbk9wZW5Ta2luUGFuZWwiLCJvbk9wZW5TdGVwUmFuayIsImlzV2VDaGF0UGxhdGZvcm0iLCJzaG93TG9hZGluZyIsIlNURVBfU0NFTkVfTkFNRSIsImhpZGVMb2FkaW5nIiwib25NdXNpY0J0bkNsaWNrIiwic3RvcEJnbU11c2ljIiwic3lzIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInNob3dfb2ZmIiwib25TaGFyZSIsImNvbnNvbGUiLCJsb2ciLCJvbk1vcmVHYW1lIiwiY2x1YmJ1dHRvbiIsImNyZWF0ZUdhbWVDbHViQnV0dG9uIiwiaWNvbiIsInN0eWxlIiwibGVmdCIsInRvcCIsIndpZHRoIiwiaGVpZ2h0Iiwic2hvdyIsImhpZGVHYW1lQ2x1YkJ1dHRvbiIsImhpZGUiLCJvbkRlc3Ryb3kiLCJkZXN0cm95IiwibV9iYW5uZXJhZCIsIm9mZiIsImJvbyIsIlNpemUiLCJ3aW5TaXplIiwiV2lkdGhub2RlIiwiZmluZCIsInBvcyIsImNvbnZlcnRUb1dvcmxkU3BhY2UiLCJ5Iiwic3lzdGVtIiwiZ2V0U3lzdGVtSW5mb1N5bmMiLCJhZGFwdFNjYWxlSCIsInNjcmVlbkhlaWdodCIsIlBvc1kiLCJTREtWZXJzaW9uIiwic2hvd1RvYXN0IiwiaW1hZ2UiLCJkdXJhdGlvbiIsInNldFRpbWVvdXQiLCJoaWRlVG9hc3QiLCJjcmVhdGVCYW5uZXJBZCIsImFkVW5pdElk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QUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVXRpbHMgPSByZXF1aXJlKFwiVXRpbHNcIik7XG52YXIgU2hhcmVTZGsgPSByZXF1aXJlKFwiU2hhcmVTZGtcIik7XG52YXIgUmFua0xpc3QgPSByZXF1aXJlKFwiUmFua0xpc3RcIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBtX3NwX2xvZ286IGNjLk5vZGUsXG4gICAgICAgIG1fbF9tYWluZ29sZDogY2MuTGFiZWwsXG4gICAgICAgIG1fc3Bfb2ZmOiBjYy5Ob2RlLFxuICAgICAgICBtX3NwYV9saXN0OiBjYy5TcHJpdGVBdGxhcyxcbiAgICAgICAgbV9zcF9teXN0ZXBpY29uOiBjYy5TcHJpdGUsXG4gICAgICAgIG1fbF9teXN0ZXBuYW1lOiBjYy5MYWJlbCxcbiAgICAgICAgbV9uX3N0YXJsaXN0OiB7IHR5cGU6IGNjLk5vZGUsIGRlZmF1bHQ6IFtdIH0sXG4gICAgICAgIG1fbl9za2lucGFuZWw6IGNjLk5vZGUsXG4gICAgICAgIG1fbl9tb3JlZ2FtZTogY2MuTm9kZSxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG5cbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIHdpbmRvdy5HQU1FX01FTlUgPSB0aGlzO1xuICAgICAgICBVdGlscy5zZXREZXNpZ25SZXNvbHV0aW9uKCk7XG4gICAgfSxcblxuICAgIHN0YXJ0KCkge1xuICAgICAgICAvLyB0aGlzLm1fc3BfbG9nby5ydW5BY3Rpb24oY2MucmVwZWF0Rm9yZXZlcihjYy5zZXF1ZW5jZShjYy5tb3ZlQnkoMSwgMCwgMTUpLCBjYy5tb3ZlQnkoMSwgMCwgLTE1KSkpKTtcbiAgICAgICAgRVZFTlRfTElTVEVORVIub24od2luZG93LkdBTUVfVVBEQVRFX0RBVEEsIHRoaXMudXBkYXRlR29sZCwgdGhpcyk7XG4gICAgICAgIHRoaXMubV9sX21haW5nb2xkLnN0cmluZyA9IHdpbmRvdy5JTklUX0dBTUVfU0FWRV9EQVRBLmdvbGRfbnVtO1xuICAgICAgICB0aGlzLnNob3dHYW1lQ2x1YkJ1dHRvbigpO1xuXG4gICAgICAgIHRoaXMudXBkYXRlTXVzaWNCdG5TcHJpdGUod2luZG93Lk1VU0lDX1NIT1dfT0ZGKTtcbiAgICAgICAgUmFua0xpc3Quc2V0U2NvcmUod2luZG93LklOSVRfR0FNRV9TQVZFX0RBVEEudG9wX3Njb3JlKTtcbiAgICAgICAgaWYgKHR5cGVvZiAod3gpICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHd4LnNob3dTaGFyZU1lbnUoe1xuICAgICAgICAgICAgICAgIHdpdGhTaGFyZVRpY2tldDogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd3gub25TaGFyZUFwcE1lc3NhZ2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIuWlveeOqeWPiOaWsOWlh++8jOa2iOejqOaXtumXtOWlveW4ruaJi1wiLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZVVybDogd2luZG93LnRlbXBGaWxlVVJMWzFdLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zaG93QWRCYW5uZXIodHJ1ZSk7XG4gICAgICAgIGlmICghd2luZG93LlNIT1dORVdZRUFSICYmIHdpbmRvdy5ORVdZRUFSKSB7XG4gICAgICAgICAgICBVdGlscy5sb2FkUmVzKFwicHJlZmFicy9oYXBweW5ld3llYXJcIiwgY2MuUHJlZmFiLCAob2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBjYy5pbnN0YW50aWF0ZShvYmopO1xuICAgICAgICAgICAgICAgIG5vZGUuekluZGV4ID0gMSA8PCAxMDtcbiAgICAgICAgICAgICAgICBub2RlLnBhcmVudCA9IHRoaXMubm9kZTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuU0hPV05FV1lFQVIgPSB0cnVlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFV0aWxzLnBsYXlCZ21NdXNpYyh3aW5kb3cuQkdNLCAwLjUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5pdE15RGF0YSgpO1xuICAgICAgICB0aGlzLm1fbl9tb3JlZ2FtZS5hY3RpdmUgPSB3aW5kb3cuTU9WRUdBTUU7XG4gICAgfSxcblxuICAgIHBsYXltdWlzYygpIHtcbiAgICAgICAgVXRpbHMucGxheUJnbU11c2ljKHdpbmRvdy5CR00sIDAuNSk7XG4gICAgfSxcblxuICAgIGluaXRNeURhdGEoKSB7XG4gICAgICAgIGxldCBjdXJsdiA9IHdpbmRvdy5JTklUX0dBTUVfU0FWRV9EQVRBLnRvcF9sZXZlbDtcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmdldE15U3RlcERhdGEoY3VybHYpO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5tX3NwX215c3RlcGljb24uc3ByaXRlRnJhbWUgPSB0aGlzLm1fc3BhX2xpc3QuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pY29uX3BhdGgpO1xuICAgICAgICAgICAgdGhpcy5tX2xfbXlzdGVwbmFtZS5zdHJpbmcgPSBkYXRhLmRlc2M7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubV9uX3N0YXJsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tX25fc3Rhcmxpc3RbaV0uYWN0aXZlID0gaSA8IGRhdGEuc3RhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubV9zcF9teXN0ZXBpY29uLnNwcml0ZUZyYW1lID0gdGhpcy5tX3NwYV9saXN0LmdldFNwcml0ZUZyYW1lKFwic3RlcGljb242XCIpO1xuICAgICAgICAgICAgdGhpcy5tX2xfbXlzdGVwbmFtZS5zdHJpbmcgPSB3aW5kb3cuU1RFUF9DT05GSUdbMF0uZGVzYztcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tX25fc3Rhcmxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1fbl9zdGFybGlzdFtpXS5hY3RpdmUgPSBpIDwgMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubV9uX3NraW5wYW5lbC5nZXRDb21wb25lbnQoXCJTa2luUGFuZWxcIikuaW5pdERhdGEoKTtcbiAgICB9LFxuXG4gICAgZ2V0TXlTdGVwRGF0YShsdikge1xuICAgICAgICBsZXQgaW5kZXggPSBNYXRoLmZsb29yKGx2IC8gMTApO1xuICAgICAgICBpZiAoaW5kZXggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiB3aW5kb3cuU1RFUF9DT05GSUcubGVuZ3RoKVxuICAgICAgICAgICAgICAgIGluZGV4ID0gd2luZG93LlNURVBfQ09ORklHLmxlbmd0aDtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuU1RFUF9DT05GSUdbaW5kZXggLSAxXTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVHb2xkKCkge1xuICAgICAgICB0aGlzLm1fbF9tYWluZ29sZC5zdHJpbmcgPSB3aW5kb3cuSU5JVF9HQU1FX1NBVkVfREFUQS5nb2xkX251bTtcbiAgICB9LFxuXG4gICAgb25TdGFydEdhbWUoKSB7XG4gICAgICAgIFV0aWxzLlNldFNvdW5kRWZmZWN0KHdpbmRvdy5CVVRUT05fQ0xJQ0tfTVVTSUMsIGZhbHNlLCAxKTtcbiAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKHdpbmRvdy5HQU1FX1NDRU5FX05BTUUpO1xuICAgIH0sXG5cbiAgICBvbkNsb3NlU2hhcmUoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSh3aW5kb3cuR0FNRV9TQ0VORV9OQU1FKTtcbiAgICB9LFxuXG4gICAgb25TaGFyZVN0YXJ0KCkge1xuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIFV0aWxzLlNldFNvdW5kRWZmZWN0KHdpbmRvdy5CVVRUT05fQ0xJQ0tfTVVTSUMsIGZhbHNlLCAxKTtcbiAgICAgICAgU2hhcmVTZGsuc2hhcmVBcHBNZXNzYWdlKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIuadpeWKqeWKm+aIkeS4gOi1t+aJk+aAquWFveWQp1wiLFxuICAgICAgICAgICAgaW1hZ2VVcmw6IHdpbmRvdy50ZW1wRmlsZVVSTFsxXSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKHdpbmRvdy5HQU1FX1NDRU5FX05BTUUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWw6IGVyciA9PiB7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wbGF0ZTogbXNnID0+IHtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uT3BlblNraW5QYW5lbCgpIHtcbiAgICAgICAgdGhpcy5tX25fc2tpbnBhbmVsLmFjdGl2ZSA9IHRydWU7XG4gICAgfSxcblxuICAgIG9uT3BlblN0ZXBSYW5rKCkge1xuICAgICAgICBVdGlscy5TZXRTb3VuZEVmZmVjdCh3aW5kb3cuQlVUVE9OX0NMSUNLX01VU0lDLCBmYWxzZSwgMSk7XG4gICAgICAgIGlmICh3aW5kb3cuaXNXZUNoYXRQbGF0Zm9ybSlcbiAgICAgICAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi5Yqg6L295LitLi4uXCIgfSk7XG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSh3aW5kb3cuU1RFUF9TQ0VORV9OQU1FLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAod2luZG93LmlzV2VDaGF0UGxhdGZvcm0pXG4gICAgICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgb25NdXNpY0J0bkNsaWNrKCkge1xuICAgICAgICBpZiAod2luZG93Lk1VU0lDX1NIT1dfT0ZGID09IDEpIHtcbiAgICAgICAgICAgIHdpbmRvdy5NVVNJQ19TSE9XX09GRiA9IDA7XG4gICAgICAgICAgICBVdGlscy5zdG9wQmdtTXVzaWMoKTtcbiAgICAgICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbXVzaWMnLCAnMCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgd2luZG93Lk1VU0lDX1NIT1dfT0ZGID0gMTtcbiAgICAgICAgICAgIFV0aWxzLnBsYXlCZ21NdXNpYyh3aW5kb3cuQkdNLCAwLjUpO1xuICAgICAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtdXNpYycsICcxJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVNdXNpY0J0blNwcml0ZSh3aW5kb3cuTVVTSUNfU0hPV19PRkYpO1xuICAgIH0sXG5cblxuICAgIHVwZGF0ZU11c2ljQnRuU3ByaXRlKHNob3dfb2ZmKSB7XG4gICAgICAgIGlmIChzaG93X29mZiA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLm1fc3Bfb2ZmLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tX3NwX29mZi5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uU2hhcmUoKSB7XG4gICAgICAgIFV0aWxzLlNldFNvdW5kRWZmZWN0KHdpbmRvdy5CVVRUT05fQ0xJQ0tfTVVTSUMsIGZhbHNlLCAxKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coY2MudXJsLnJhdyhcInJlc291cmNlcy9jb21tb24vc2hhcmVwaWMuODU2NjMucG5nXCIpKTtcbiAgICAgICAgU2hhcmVTZGsuc2hhcmVBcHBNZXNzYWdlKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIuS7iuW5tOacgOWlveeOqeacgOWIuua/gOeahOWFrei+ueW9oua2iOmZpOaAquWFvea4uOaIj++8jOW/q+adpeWwneivleS4i1wiLFxuICAgICAgICAgICAgaW1hZ2VVcmw6IHdpbmRvdy50ZW1wRmlsZVVSTFsxXSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXNcIiwgcmVzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWw6IGVyciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXMtZXJyXCIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxhdGU6IG1zZyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb21wbGF0ZVwiKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uTW9yZUdhbWUoKSB7XG4gICAgICAgIC8vIGlmICh0eXBlb2YgKHd4KSAhPSAndW5kZWZpbmVkJyAmJiB3eC5uYXZpZ2F0ZVRvTWluaVByb2dyYW0pIHtcbiAgICAgICAgLy8gICAgIHd4Lm5hdmlnYXRlVG9NaW5pUHJvZ3JhbSh7XG4gICAgICAgIC8vICAgICAgICAgYXBwSWQ6IFwid3g3MTA5MzA5MjE0ZjRjODZlXCIsXG4gICAgICAgIC8vICAgICAgICAgLy90YXJnZXQ6IFwid3g2ZWU5Y2FlMDc3ODUxZGZhXCIsXG4gICAgICAgIC8vICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ+i3s+i9rOaIkOWKnycpO1xuICAgICAgICAvLyAgICAgICAgICAgICAvLyBzdWNjZXNzcyAmJiBzdWNjZXNzcyhyZXMpO1xuICAgICAgICAvLyAgICAgICAgIH0sXG4gICAgICAgIC8vICAgICAgICAgZmFpbDogZXJyID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCLot7PovazlpLHotKXvvJpcIiwgZXJyKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgLy8gZmFpbGwgJiYgZmFpbGwoZXJyKTtcbiAgICAgICAgLy8gICAgICAgICB9LFxuICAgICAgICAvLyAgICAgICAgIGNvbXBsZXRlOiByZXMgPT4ge1xuICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZygn6Lez6L2s5a6M5oiQJylcbiAgICAgICAgLy8gICAgICAgICAgICAgLy8gY29tcGxldGVlICYmIGNvbXBsZXRlZShyZXMpO1xuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgd3hTaG9ydEN1dC5zaG93TW9kYWwoXCLmj5DnpLpcIiwgXCLmmoLmnKrlvIDmlL5cIik7XG4gICAgICAgIC8vIH1cbiAgICB9LFxuXG4gICAgc2hvd0dhbWVDbHViQnV0dG9uKCkge1xuICAgICAgICBpZiAodHlwZW9mICh3eCkgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5jbHViYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbHViYnV0dG9uID0gd3guY3JlYXRlR2FtZUNsdWJCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICBpY29uOiAnbGlnaHQnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jbHViYnV0dG9uLnNob3coKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGlkZUdhbWVDbHViQnV0dG9uKCkge1xuICAgICAgICBpZiAodGhpcy5jbHViYnV0dG9uKSB7XG4gICAgICAgICAgICB0aGlzLmNsdWJidXR0b24uaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuY2x1YmJ1dHRvbikge1xuICAgICAgICAgICAgdGhpcy5jbHViYnV0dG9uLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuY2x1YmJ1dHRvbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubV9iYW5uZXJhZCkge1xuICAgICAgICAgICAgdGhpcy5tX2Jhbm5lcmFkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMubV9iYW5uZXJhZCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgRVZFTlRfTElTVEVORVIub2ZmKHdpbmRvdy5HQU1FX1VQREFURV9EQVRBLCB0aGlzKTtcbiAgICAgICAgd2luZG93LkdBTUVfTUVOVSA9IG51bGw7XG4gICAgfSxcblxuICAgIHNob3dBZEJhbm5lcihib28pIHtcbiAgICAgICAgaWYgKHR5cGVvZiAod3gpID09ICd1bmRlZmluZWQnKSByZXR1cm47XG4gICAgICAgIGxldCBTaXplID0gY2Mud2luU2l6ZVxuXG4gICAgICAgIGxldCBXaWR0aG5vZGUgPSBjYy5maW5kKFwiQ2FudmFzL25fZnVubnltYXAvbl9iYW5uZXJwb3NcIik7XG4gICAgICAgIHZhciBwb3MgPSB0aGlzLm5vZGUuY29udmVydFRvV29ybGRTcGFjZShXaWR0aG5vZGUpO1xuXG4gICAgICAgIGlmIChTaXplLmhlaWdodCAvIFNpemUud2lkdGggPiAyKSB7Ly/pgILphY3lhajpnaLlsY8g6YCC55So5LqORklYSGVpZ2h0XG4gICAgICAgICAgICBwb3MueSArPSAoU2l6ZS5oZWlnaHQgLSAxOTIwKSAvIDI7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc3lzdGVtID0gd3guZ2V0U3lzdGVtSW5mb1N5bmMoKTtcblxuICAgICAgICBsZXQgYWRhcHRTY2FsZUggPSBzeXN0ZW0uc2NyZWVuSGVpZ2h0IC8gU2l6ZS5oZWlnaHQ7XG4gICAgICAgIHZhciBQb3NZID0gKChTaXplLmhlaWdodCAtIHBvcy55KSAqIGFkYXB0U2NhbGVIKTtcblxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIGlmICghYm9vKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tX2Jhbm5lcmFkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tX2Jhbm5lcmFkLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1fYmFubmVyYWQpXG4gICAgICAgICAgICAgICAgdGhpcy5tX2Jhbm5lcmFkLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMubV9iYW5uZXJhZCAmJiBib28pIHtcbiAgICAgICAgICAgIGlmIChzeXN0ZW0uU0RLVmVyc2lvbiA8ICcyLjAuNCcpIHtcbiAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCLlvq7kv6HniYjmnKzov4fkvY7vvIzml6Dms5XliJvlu7rlub/lkYpiYW5uZXJcIixcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJub25lXCIsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHd4LmhpZGVUb2FzdCgpLCAzMDAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZi5tX2Jhbm5lcmFkID0gd3guY3JlYXRlQmFubmVyQWQoe1xuICAgICAgICAgICAgICAgICAgICBhZFVuaXRJZDogJ2FkdW5pdC05ZGQwNTdiNmI1MTQyNDVhJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IFBvc1ksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogc3lzdGVtLnNjcmVlbldpZHRoLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBzZWxmLm1fYmFubmVyYWQub25SZXNpemUoKHJlczEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLm1fYmFubmVyYWQgJiYgc2VsZi5tX2Jhbm5lcmFkLnN0eWxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1fYmFubmVyYWQuc3R5bGUudG9wID0gUG9zWTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1fYmFubmVyYWQuc3R5bGUuaGVpZ2h0ID0gcmVzMS5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm9uUmVzaXplLWVycm9yXCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNlbGYubV9iYW5uZXJhZC5vbkxvYWQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYmFubmVyIOW5v+WRiuWKoOi9veaIkOWKnycpXG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHNlbGYubV9iYW5uZXJhZC5zaG93KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5bm/5ZGK5pi+56S65oiQ5YqfXCIpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuW5v+WRiuWKoOi9veWksei0pVwiLCBlcnIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgc2VsZi5tX2Jhbm5lcmFkLm9uRXJyb3IoZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19