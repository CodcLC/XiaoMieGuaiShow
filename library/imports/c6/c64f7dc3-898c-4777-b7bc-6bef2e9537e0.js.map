{"version":3,"sources":["assets\\Script\\GameLoad.js"],"names":["require","ShareSdk","Utils","cc","Class","Component","properties","m_n_logo","Node","m_loaded","m_l_text","Label","start","setDesignResolution","opacity","m_loaded2","self","_loadnum","wx","cloud","init","env","window","ENV","traceUser","success","res","runAction","sequence","fadeIn","callFunc","loadres","loadconfig","boo","sys","localStorage","getItem","guideboo","change","console","log","MUSIC_SHOW_OFF","parseInt","setItem","GUIDE_LEVEL","CHANGE_BLOCK","setShareMenuEnabled","this$1","enterGame","tempFileURL","i","push","loader","loadRes","err","obj","error","message","MAP_CONFIG","json","MyPreloadScene","MENU_SCENE_NAME","completedCount","totalCount","item","string","Math","floor","sceneName","onProgress","onLoaded","undefined","director","emit","Director","EVENT_BEFORE_SCENE_LOADING","loadScene","hideLoading"],"mappings":"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AAC1B;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAf,MAAAA,EAAE,CAACiD,MAAH,CAAUC,OAAV,CAAkB,eAAlB,EAAmC,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACnD,YAAID,GAAJ,EAAS;AACLnD,UAAAA,EAAE,CAACqD,KAAH,CAASF,GAAG,CAACG,OAAJ,IAAeH,GAAxB;AACA;AACH;;AAEDhC,QAAAA,MAAM,CAACoC,UAAP,GAAoBH,GAAG,CAACI,IAAxB;AACA3C,QAAAA,IAAI,CAACC,QAAL;AACAD,QAAAA,IAAI,CAACgC,SAAL;AACH,OATD,EA9D0B,CAwE1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KAlGD,MAkGO;AACHhC,MAAAA,IAAI,CAACC,QAAL,GAAgB,CAAhB;AACAd,MAAAA,EAAE,CAACiD,MAAH,CAAUC,OAAV,CAAkB,eAAlB,EAAmC,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACnD,YAAID,GAAJ,EAAS;AACLnD,UAAAA,EAAE,CAACqD,KAAH,CAASF,GAAG,CAACG,OAAJ,IAAeH,GAAxB;AACA;AACH;;AAEDhC,QAAAA,MAAM,CAACoC,UAAP,GAAoBH,GAAG,CAACI,IAAxB;AACA3C,QAAAA,IAAI,CAACC,QAAL;AACAD,QAAAA,IAAI,CAACgC,SAAL;AACH,OATD;AAUH;;AAED,SAAKY,cAAL,CAAoBtC,MAAM,CAACuC,eAA3B,EAA4C,UAACC,cAAD,EAAiBC,UAAjB,EAA6BC,IAA7B,EAAsC;AAC9EhD,MAAAA,IAAI,CAACN,QAAL,CAAcuD,MAAd,GAAuB,aAAaC,IAAI,CAACC,KAAL,CAAYL,cAAc,GAAGC,UAAlB,GAAgC,GAA3C,CAAb,GAA+D,GAAtF;AACH,KAFD,EAEG,YAAM;AACLxB,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAxB,MAAAA,IAAI,CAACC,QAAL;AACAD,MAAAA,IAAI,CAACgC,SAAL;AACH,KAND;AAOH,GA3MI;AA6MLY,EAAAA,cA7MK,0BA6MUQ,SA7MV,EA6MqBC,UA7MrB,EA6MiCC,QA7MjC,EA6M2C;AAC5C,QAAIA,QAAQ,KAAKC,SAAjB,EAA4B;AACxBD,MAAAA,QAAQ,GAAGD,UAAX;AACAA,MAAAA,UAAU,GAAG,IAAb;AACH,KAJ2C,CAK5C;AACA;AACA;;;AACIlE,IAAAA,EAAE,CAACqE,QAAH,CAAYC,IAAZ,CAAiBtE,EAAE,CAACuE,QAAH,CAAYC,0BAA7B,EAAyDP,SAAzD;AACAjE,IAAAA,EAAE,CAACqE,QAAH,CAAYI,SAAZ,CAAsBtD,MAAM,CAACuC,eAA7B,EATwC,CAU5C;AACA;AACA;AACA;AACA;AACA;AACH,GA7NI;AA8NLb,EAAAA,SAAS,EAAE,qBAAY;AACnB,QAAI,KAAK/B,QAAL,IAAiB,CAArB,EAAwB;AACpB,UAAI,OAAQC,EAAR,IAAe,WAAnB,EACIA,EAAE,CAAC2D,WAAH;AACJ1E,MAAAA,EAAE,CAACqE,QAAH,CAAYI,SAAZ,CAAsBtD,MAAM,CAACuC,eAA7B;AACH;AACJ;AApOI,CAAT","sourceRoot":"/","sourcesContent":["require(\"./common/Wxlife\");\nvar ShareSdk = require(\"ShareSdk\");\nvar Utils = require(\"Utils\")\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_n_logo: cc.Node,\n        m_loaded: false,\n        m_l_text: cc.Label,\n    },\n\n    start() {\n        Utils.setDesignResolution()\n        this.m_n_logo.opacity = 0;\n        this.m_loaded = false;\n        this.m_loaded2 = false;\n        let self = this;\n        this._loadnum = 0;\n        if (typeof (wx) != 'undefined') {\n            wx.cloud.init({\n                env: window.ENV,\n                traceUser: true,\n                success: (res) => {\n                    // console.log(\"init-\", res);\n                }\n            });\n        }\n        this.m_n_logo.runAction(cc.sequence(cc.fadeIn(0.2), cc.callFunc(() => {\n            self.loadres();\n            self.loadconfig();\n        })));\n        // cc.view.enableRetina(true);\n        let boo = cc.sys.localStorage.getItem('music');\n        let guideboo = cc.sys.localStorage.getItem('guideinfo');\n        let change = cc.sys.localStorage.getItem('change');\n        console.log('guideboo', guideboo);\n        if (boo && boo != 'null') {\n            window.MUSIC_SHOW_OFF = parseInt(boo);\n        } else {\n            window.MUSIC_SHOW_OFF = 1;//默认开启\n            cc.sys.localStorage.setItem('music', '' + window.MUSIC_SHOW_OFF);\n        }\n\n        if (guideboo && guideboo != 'null') {\n            window.GUIDE_LEVEL = 1;\n        } else {\n            window.GUIDE_LEVEL = 0;\n            // cc.sys.localStorage.setItem('guideinfo', '1');\n        }\n        if (change && change != 'null') {\n            window.CHANGE_BLOCK = 1;\n        } else {\n            window.CHANGE_BLOCK = 0;\n        }\n        ShareSdk.setShareMenuEnabled(true, true);\n\n    },\n\n    loadconfig() {\n        let this$1 = this;\n        this$1._loadnum++;\n        this$1.enterGame();\n        // let remoteUrl = 'https://gifen-1253495541.cosgz.myqcloud.com/KillMonster/share_config.json';\n        // cc.loader.load(remoteUrl, function (err, netobj) {\n        //     if (err) {\n        //         console.error(err);\n        //         this$1._loadnum++;\n        //         this$1.enterGame();\n        //     } else {\n        //         window.BOX_SHARE = netobj.box_share;\n        //         window.SKIN_SHARE = netobj.skin_share;\n        //         window.MOVEGAME = netobj.moregame;\n        //         window.NEWYEAR = netobj.newyear;\n        //         console.warn(netobj);\n\n        //     }\n        // });\n    },\n\n    loadres() {\n        console.log(\"load res\");\n        let self = this;\n        window.tempFileURL = [];\n        for (let i = 1; i < 4; i++) {\n            window.tempFileURL.push(\"\");\n        }\n        if (typeof wx != 'undefined') {\n            // wx.showLoading({\n            //     title: \"登录中...\"\n            // });\n\n            // wx.cloud.getTempFileURL({\n            //     fileList: ['cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/game_config/level_config2.json',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share1.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_normal.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_result.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_box.jpg'],\n            //     success: (res) => {\n            //         // console.log(res.fileList[0]);\n            //         window.tempFileURL = [];\n            //         let data = res.fileList[0];\n            //         for (let i = 1; i < res.fileList.length; i++) {\n            //             window.tempFileURL.push(res.fileList[i].tempFileURL);\n            //         }\n\n            //         if (data.status == 0) {\n            //             cc.loader.load(data.tempFileURL, function (err, netobj) {\n            //                 if (err) {\n            //                     cc.loader.loadRes('level_config2', function (err, obj) {\n            //                         if (err) {\n            //                             cc.error(err.message || err);\n            //                             return;\n            //                         }\n            //                         window.MAP_CONFIG = obj;\n            //                         window.dailypointdata = obj.daily_step;\n            //                         self._loadnum++;\n            //                         self.enterGame();\n            //                     });\n            //                 } else {\n            //                     window.MAP_CONFIG = netobj\n            //                     self._loadnum++;\n            //                     self.enterGame();\n            //                 }\n            //             });\n            //         } else {\n            //             cc.loader.loadRes('level_config2', function (err, obj) {\n            //                 if (err) {\n            //                     cc.error(err.message || err);\n            //                     return;\n            //                 }\n            //                 window.MAP_CONFIG = obj;\n            //                 self._loadnum++;\n            //                 self.enterGame();\n            //             });\n            //         }\n            //     },\n            //     fail: () => {\n            //         cc.loader.loadRes('level_config2', function (err, obj) {\n            //             if (err) {\n            //                 cc.error(err.message || err);\n            //                 return;\n            //             }\n            //             window.MAP_CONFIG = obj;\n            //             self._loadnum++;\n            //             self.enterGame();\n            //         });\n            //     }\n            // })\n            cc.loader.loadRes('level_config2', function (err, obj) {\n                if (err) {\n                    cc.error(err.message || err);\n                    return;\n                }\n\n                window.MAP_CONFIG = obj.json;\n                self._loadnum++;\n                self.enterGame();\n            });\n            //登录\n            // wx.cloud.callFunction({\n            //     // 云函数名称\n            //     name: 'login',\n            //     // 传给云函数的参数\n            //     success: function (res) {\n            //         console.log(res.result.event.userInfo);\n            //         window.userInfo = res.result.event.userInfo;\n            //         Utils.getSaveData(res => {\n            //             window.getdata = true;\n            //             self._loadnum++;\n            //             self.enterGame();\n            //         })\n            //     },\n            //     fail: (err) => {\n            //         console.error(err);\n            //         wx.showModal({\n            //             title: \"提示\",\n            //             content: \"登录异常，请稍后重试:\" + err.Msg,\n            //             showCancel: false,\n            //             success: () => {\n            //                 wx.exitMiniProgram();\n            //             }\n            //         })\n            //     }\n            // })\n        } else {\n            self._loadnum = 1;\n            cc.loader.loadRes('level_config2', function (err, obj) {\n                if (err) {\n                    cc.error(err.message || err);\n                    return;\n                }\n\n                window.MAP_CONFIG = obj.json;\n                self._loadnum++;\n                self.enterGame();\n            });\n        }\n\n        this.MyPreloadScene(window.MENU_SCENE_NAME, (completedCount, totalCount, item) => {\n            self.m_l_text.string = \"游戏加载中...\" + Math.floor((completedCount / totalCount) * 100) + \"%\";\n        }, () => {\n            console.log(\"preloadScene finish\");\n            self._loadnum++;\n            self.enterGame();\n        });\n    },\n\n    MyPreloadScene(sceneName, onProgress, onLoaded) {\n        if (onLoaded === undefined) {\n            onLoaded = onProgress;\n            onProgress = null;\n        }\n        // cc.director.loadScene(window.MENU_SCENE_NAME);\n        // var info = cc.director._getSceneUuid(sceneName);\n        // if (info) {\n            cc.director.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING, sceneName);\n            cc.director.loadScene(window.MENU_SCENE_NAME)\n        // }\n        // else {\n        //     var error = 'Can not preload the scene \"' + sceneName + '\" because it is not in the build settings.';\n        //     onLoaded(new Error(error));\n        //     cc.error('preloadScene: ' + error);\n        // }\n    },\n    enterGame: function () {\n        if (this._loadnum >= 4) {\n            if (typeof (wx) != 'undefined')\n                wx.hideLoading();\n            cc.director.loadScene(window.MENU_SCENE_NAME);\n        }\n    }\n});\n"]}